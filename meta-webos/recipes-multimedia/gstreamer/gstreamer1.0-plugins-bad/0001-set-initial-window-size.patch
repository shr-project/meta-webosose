From 86e37e689c953fa7fe63cab19621be87c97b5e75 Mon Sep 17 00:00:00 2001
From: Martin Jansa <martin.jansa@lge.com>
Date: Mon, 25 Jan 2021 14:17:07 -0800
Subject: [PATCH] set initial window size

---
 subprojects/gst-plugins-bad/ext/wayland/gstwaylandsink.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/subprojects/gst-plugins-bad/ext/wayland/gstwaylandsink.c b/subprojects/gst-plugins-bad/ext/wayland/gstwaylandsink.c
index 0761304ce3..a2a7c9b933 100644
--- a/subprojects/gst-plugins-bad/ext/wayland/gstwaylandsink.c
+++ b/subprojects/gst-plugins-bad/ext/wayland/gstwaylandsink.c
@@ -721,6 +721,14 @@ gst_wayland_sink_show_frame (GstVideoSink * vsink, GstBuffer * buffer)
           &sink->video_info, sink->fullscreen, &sink->render_lock);
       g_signal_connect_object (sink->window, "closed",
           G_CALLBACK (on_window_closed), sink, 0);
+    } else {
+      gint width;
+      /* set the initial size to be the same as the reported video size
+      * since the app does not pass the size even if it set window handle */
+      width = gst_util_uint64_scale_int_round (sink->video_info.width,
+        sink->video_info.par_n, sink->video_info.par_d);
+      gst_wl_window_set_render_rectangle (sink->window, 0, 0, width,
+        sink->video_info.height);
     }
   }
 
