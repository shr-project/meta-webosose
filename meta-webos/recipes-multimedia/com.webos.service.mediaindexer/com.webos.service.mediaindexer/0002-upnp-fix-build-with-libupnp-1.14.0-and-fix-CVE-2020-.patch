From 36d6f8712a4ad5acc6cf0f3873a8d7f8c33bd5c0 Mon Sep 17 00:00:00 2001
From: Martin Jansa <martin.jansa@lge.com>
Date: Thu, 8 Oct 2020 15:49:56 +0900
Subject: [PATCH] upnp: fix build with libupnp-1.14.0 and fix
 CVE-2020-12695

UpnpInit is deprecated since a long time and was finally dropped in:
https://github.com/pupnp/pupnp/commit/7b3f0f5f497f9f493c82307af495b87fa9ebdacb

The old imlementation is vulnerable to CallStranger a.k.a. CVE-2020-12695
---
 src/plugins/upnp.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/plugins/upnp.cpp b/src/plugins/upnp.cpp
index d24be30..fba0613 100644
--- a/src/plugins/upnp.cpp
+++ b/src/plugins/upnp.cpp
@@ -41,7 +41,7 @@ std::shared_ptr<Plugin> Upnp::instance()
 Upnp::Upnp() : Plugin(Upnp::uri)
 {
     upnpHandle_ = -1;
-    auto err = UpnpInit(NULL, 0);
+    auto err = UpnpInit2(NULL, 0);
     if (err)
         LOG_CRITICAL(0, "UpnpInit2() failed (%i)", err);
 }
-- 
2.17.1

